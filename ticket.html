<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Document</title>
</head>

<body>
  <div id="wrapper">
    <header>
      <h1></h1>
      <ul>
        <li></li>
        <li></li>
        <li></li>
      </ul>
    </header>
    <div id="main">
      <div id="wrapper-adult">
        <button data-price="440" id="adult">Voksen</button>
      </div>
      <div id="wrapper-child">
        <button data-price="280" id="child">Barn</button>
      </div>
      <div id="people"></div>
      <div id="status"></div>
    </div>
    <footer>

    </footer>
  </div>
</body>

</html>

<script>
  class Person {
    constructor(type, price, days) {
      this.type = type;
      this.price = price;
      this.days = days;
    }
    addDay() {
      var price = (this.price / this.days);
      this.days++;
      this.price += price
    }
    removeDay() {
      var price = (this.price / this.days);
      this.days--;
      this.price -= price;
    }
  }

  var people = document.getElementById('people');
  var orderStatus = document.getElementById('status');
  var total
  var limit = 1500;
  var order = [];


  var adult = document.getElementById('adult');
  var child = document.getElementById('child');
  adult.onclick = addToOrder;
  child.onclick = addToOrder;

  //Function for ordering for a new person, information is stored as an object and passed to the array "order"
  function addToOrder() {
    var price = Number(this.getAttribute("data-price"));
    person = new Person(this.id, price, 1);
    order.push(person);
    console.log(person);
    addEditor(this.innerHTML);
    updateOrder();
  }

  function editDays() {
    var string = this.parentNode.id
    string = string.split("-");
    var id = string[1];
    if (this.id == "plus") {
      order[id].addDay();
    }
    else {
      console.log(this.id)
      order[id].removeDay();
      if (order[id].days == 0) {
        order.splice(id, 1);
      }
    }
    updateOrder()
  }

  var id = 0;

  function addEditor(type) {
    var plus = document.createElement('div');
    var minus = document.createElement('div');
    //TODO: Refactor to better fit the style of coding in updateOrder()
    plus.innerHTML = "+";
    minus.innerHTML = "-";
    //var plusID = "plus-" + id;
    //var minusID = "minus-" + id;
    plus.setAttribute("id", "plus")
    minus.setAttribute("id", "minus");
    var div = document.createElement('div')
    div.innerHTML = `<h4>${type}</h4>`
    var divID = "wrapper-" + id;
    div.setAttribute("id", divID);
    people.appendChild(div);
    div.appendChild(plus);
    div.appendChild(minus);

    plus.addEventListener("click", editDays);
    minus.addEventListener("click", editDays);
    id++
  }

  //Update order
  var tbody = document.createElement('table');
  function updateOrder() {
    tbody.innerHTML = "<tr><td>Type</td><td>Pris</td><td>Dager</td></tr>"
    //Double for-loop, one for the array of objects, the other for going through the object properties
    for (let row = 0; row <= order.length; row++) {
      var tr = document.createElement('tr');
      for (var property in order[row]) {
        var td = document.createElement('td');
        td.appendChild(document.createTextNode(order[row][property]));
        tr.appendChild(td);
      }
      tbody.appendChild(tr)
    }
    orderStatus.appendChild(tbody);
  }


</script>