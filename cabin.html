<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <link rel="stylesheet" href="styles.css">
  <link rel="stylesheet" href="cabin.css">
  <title>BARSK Hytter</title>
</head>

<body>
  <div id="wrapper">
  <header>
    <h1>BARSK</h1>
    <ul>
      <li><a href="index.html">Hjem</a></li>
      <li><a href="ticket.html">Heiskort</a></li>
      <li><a href="cabin.html">Hytter</a></li>
    </ul>
  </header>
    <div id="main">
      <div id="menu">
        <img id="cabins" src="src/menybilde.jpg" usemap="#cabinmap" alt="">
        <map name="cabinmap">
          <area id="Grantoppen" shape="rect" coords="(150, 245, 445, 433)">
          <area id="Granbo" shape="rect" coords="(478, 147, 647, 275)">
          <area id="Granstua" shape="rect" coords="(650, 215, 825, 360)">
          <area id="Granhaug" shape="rect" coords="(826, 212, 968 , 326)">
        </map>
      </div>
      <div id="display">
      </div>
      <div id="gallery">
  
      </div>
    <footer>

    </footer>
  </div>
</body>

</html>
<script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/2.1.2/TweenMax.min.js"></script>

<script>
  var cabins = [
    {
      "name": "Granstua",
      "beds": 4,
      "standard": "Høy",
      "sauna": 'Ja',
      "price": 12000,
      "images": 3
    },
    {
      "name": "Granbo",
      "beds": 6,
      "standard": "Middels",
      "sauna": 'Nei',
      "price": 15000,
      "images": 3
    },
    {
      "name": "Grantoppen",
      "beds": 8,
      "standard": "Lav",
      "sauna": 'Nei',
      "price": 16000,
      "images": 3
    },
    {
      "name": "Granhaug",
      "beds": 10,
      "standard": "Høy",
      "sauna": 'Ja',
      "price": 30000,
      "images": 3
    }
  ]
  var cabinMap = document.getElementById('cabins');
  var grantoppen = document.getElementById('Grantoppen');
  var granbo = document.getElementById('Granbo');
  var granstua = document.getElementById('Granstua');
  var granhaug = document.getElementById('Granhaug');
  var display = document.getElementById('display');
  var displayTable = document.getElementById('displayTable');
  var gallery = document.getElementById('gallery');
  grantoppen.addEventListener('click', displayCabin);
  granbo.addEventListener('click', displayCabin);
  granstua.addEventListener('click', displayCabin);
  granhaug.addEventListener('click', displayCabin);
  
  var selectOpen = false;

  function selectImage() {
    var xprevious = this.left;
    var yprevious = this.top;

    if (!selectOpen) {
      picture = this.cloneNode(true);
      picture.addEventListener('click', selectImage);
      gallery.appendChild(picture);
      picture.style.position = "absolute";
      var xpos = (window.innerWidth - this.width) / 2;
      var ypos = (window.innerHeight - this.height) / 2;

      picture.style.top = ypos + "px";
      picture.style.left = xpos + "px";
      picture.style.opacity = 1;
      selectOpen = true;
      return 0;
    }
    if (selectOpen) {
      console.log(picture)
      gallery.removeChild(picture);
      selectOpen = false;
    }

  }

  var liveGallery = [];

  function loadImages(name, amount) {
    //remove previous event listeners
    for (let i = 0; i < liveGallery.length; i++) {
      liveGallery[i].removeEventListener('click', selectImage);
    }
    liveGallery.splice(0, amount);
    gallery.innerHTML = "";
    var imageName = name;
    for (let i = 1; i < amount + 1; i++) {
      imageName += i;
      var img = document.createElement('img')
      img.src = `src/${imageName}.jpg`;
      img.className = 'galleryImage'
      gallery.appendChild(img);
      imageName = name;
      liveGallery.push(img);
      //adding event listener to all of the images in the gallery
    }
    TweenMax.staggerTo(".galleryImage", 1, {opacity: 0.95}, 0.2)
    for (let i = 0; i < liveGallery.length; i++) { 
      liveGallery[i].addEventListener('click', selectImage);
    }
  }

  function displayCabin() {
    //Arrow function to find the specific index
    display.innerHTML = "";
    var id = cabins.findIndex(cabin => cabin.name == this.id);
    var tbody = document.createElement('table');
    var tr = document.createElement('tr');
    tbody.innerHTML = '<tr><th>Hyttenavn</th><th>Senger</th><th>Standard</th><th>Sauna</th><th>Pris</th></tr>'
    tr = document.createElement('tr');
    for (var property in cabins[id]) {
      if (property != 'images') {
        var td = document.createElement('td');
        td.appendChild(document.createTextNode(`${cabins[id][property]}`))
        tr.appendChild(td);
      }
    }
    tbody.appendChild(tr);
    display.appendChild(tbody); 
    loadImages(cabins[id].name, cabins[id].images);
    setTimeout(function() {
      gallery.scrollIntoView();
    }, 50) //6ms at minimum, a bit more for slower machines
  }

  //Gallery functionality
  

  //
  var mapHeight = cabinMap.height;
  var mapWidth = cabinMap.width;
  grantoppen.coords = `(${150/1280*mapWidth}, ${245/720*mapHeight}, ${445/1280*mapWidth}, ${433/720*mapHeight})`
  granbo.coords = `(${478/1280*mapWidth}, ${147/720*mapHeight}, ${647/1280*mapWidth}, ${275/720*mapHeight})`
  granstua.coords = `(${650/1280*mapWidth}, ${215/720*mapHeight}, ${825/1280*mapWidth}, ${360/720*mapHeight})`
  granhaug.coords = `(${826/1280*mapWidth}, ${212/720*mapHeight}, ${968/1280*mapWidth}, ${326/720*mapHeight})`
 
</script>